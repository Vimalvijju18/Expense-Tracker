{% extends 'base.html' %}
{% block content %}
<div style="display:grid;grid-template-columns:1fr 360px;gap:18px">
  <!-- LEFT: Dashboard + Charts -->
  <div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2>Summary</h2>
          <p class="kicker">Quick insights for this month</p>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="selectMonth"></select>
          <button id="refreshSummary" class="btn small">Refresh</button>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px;align-items:center">
        <div class="total-box">
          <small>Total Expense</small>
          <strong>₹ <span id="totalExpense">0</span></strong>
        </div>
        <div class="total-box">
          <small>Total Income</small>
          <strong>₹ <span id="totalIncome">0</span></strong>
        </div>
        <div class="total-box">
          <small>Budget</small>
          <strong>₹ <span id="budgetVal">0</span></strong>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:18px;align-items:start">
        <div style="flex:1" class="canvas-wrap"><canvas id="catChart" height="240"></canvas></div>
        <div style="flex:1" class="canvas-wrap"><canvas id="trendChart" height="240"></canvas></div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Transactions</h3>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <input id="q" placeholder="Search title or notes" style="flex:1;padding:10px;border-radius:10px;border:1px solid #e8eef8" />
        <select id="filterCat" style="width:160px;padding:10px;border-radius:10px;border:1px solid #e8eef8"><option value="">All categories</option></select>
        <select id="filterKind" style="width:120px;padding:10px;border-radius:10px;border:1px solid #e8eef8">
          <option value="">All</option><option value="expense">Expense</option><option value="income">Income</option>
        </select>
        <input id="from" type="date" />
        <input id="to" type="date" />
        <button id="filterBtn" class="btn small">Filter</button>
      </div>

      <table id="txTable">
        <thead><tr><th>Date</th><th>Title</th><th>Category</th><th>Type</th><th>Amount</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- RIGHT: Add / Recurring / Export -->
  <div>
    <div class="card">
      <h3>Add Transaction</h3>
      <form id="addForm" style="display:flex;flex-direction:column;gap:8px">
        <select id="kind">
          <option value="expense">Expense</option><option value="income">Income</option>
        </select>
        <input id="title" placeholder="Title (e.g., Lunch, Salary)" />
        <input id="amount" placeholder="Amount" type="number" step="0.01" />
        <input id="category" placeholder="Category (Food, Rent...)" />
        <input id="date" type="date" />
        <textarea id="notes" placeholder="Notes (optional)"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" type="submit">Add</button>
        </div>
      </form>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Recurring Payments</h3>
      <form id="recForm" style="display:flex;flex-direction:column;gap:8px">
        <input id="r_title" placeholder="Title (eg. Rent)" />
        <input id="r_amount" placeholder="Amount" type="number" />
        <input id="r_category" placeholder="Category" />
        <select id="r_cadence"><option value="monthly">Monthly</option><option value="weekly">Weekly</option></select>
        <input id="r_next" type="date" />
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" type="submit">Add Recurring</button>
        </div>
      </form>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="runRecurring" class="btn small">Run Recurring Now</button>
        <button id="exportCSV" class="btn small">Export CSV</button>
        <label class="btn small" style="cursor:pointer">
          Import CSV
          <input id="importCSV" type="file" accept=".csv" style="display:none"/>
        </label>
        <button id="backupJson" class="btn small">Backup JSON</button>
        <label class="btn small" style="cursor:pointer">Restore JSON<input id="restoreJSON" type="file" accept=".json" style="display:none"/></label>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Settings</h3>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="monthlyBudget" placeholder="Monthly budget (₹)" />
        <button id="saveBudget" class="btn small">Save</button>
      </div>
      <div id="budgetAlert" style="margin-top:8px;color:var(--danger);display:none"></div>
    </div>
  </div>
</div>
{% endblock %}
